<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctor Dashboard — iLARS</title>
  <script>
    // Hide page immediately - before any rendering
    (function() {
      document.documentElement.style.visibility = 'hidden';
      document.documentElement.style.opacity = '0';
    })();
  </script>
  <link rel="stylesheet" href="css/style.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      min-height: 100vh;
      padding-top: 80px;
      padding-bottom: 40px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .navbar-menu a.btn-login, .navbar-cta a.btn-login, a.btn-login {
      display: inline-flex !important; 
      color: #ffffff !important;
      background-color: #667eea !important;
      background-image: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #ff9a56 100%) !important;
      background-size: 200% 200% !important; 
      border-radius: 9999px !important;
      padding: 0.5rem 1.25rem !important; 
      box-shadow: 0 4px 14px rgba(102, 126, 234, 0.4) !important;
      text-decoration: none !important; 
      font-weight: 600 !important;
    }
    .navbar-menu a.btn-login::after { display: none !important; }

    .container {
      max-width: 1400px;
      /* Center horizontally with soft outer margin */
      margin: 20px auto;
      background: rgba(255, 255, 255, 0.45);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 
                  inset 0 1px 0 rgba(255, 255, 255, 0.5);
      padding: 48px;
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      color: rgba(30, 30, 50, 0.95);
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      margin-bottom: 32px;
      font-size: 42px;
      font-weight: 700;
      letter-spacing: -0.5px;
      line-height: 1.2;
    }

    .patient-list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .patient-list-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-left: auto;
    }

    .create-patient-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.55rem 1.4rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: #ffffff;
      background-image: linear-gradient(135deg, #667eea 0%, #764ba2 30%, #f093fb 100%);
      border: none;
      border-radius: 999px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(102, 126, 234, 0.45);
      transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s ease;
      white-space: nowrap;
    }

    .create-patient-btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.6);
      opacity: 0.96;
    }

    .create-patient-btn:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    .loading {
      text-align: center;
      padding: 60px 40px;
      color: rgba(30, 30, 50, 0.7);
      font-size: 16px;
      font-weight: 500;
    }

    .loading::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }

    .skeleton-row {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      position: relative;
      overflow: hidden;
    }

    .skeleton-row td {
      padding: 16px 20px;
    }

    .skeleton-cell {
      height: 20px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 6px;
      position: relative;
      overflow: hidden;
    }

    .skeleton-cell::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.25) 50%,
        transparent 100%
      );
      animation: shimmer 1.8s ease-in-out infinite;
    }

    .skeleton-row:nth-child(1) .skeleton-cell::after { animation-delay: 0s; }
    .skeleton-row:nth-child(2) .skeleton-cell::after { animation-delay: 0.15s; }
    .skeleton-row:nth-child(3) .skeleton-cell::after { animation-delay: 0.3s; }
    .skeleton-row:nth-child(4) .skeleton-cell::after { animation-delay: 0.45s; }
    .skeleton-row:nth-child(5) .skeleton-cell::after { animation-delay: 0.6s; }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .error {
      background: rgba(255, 59, 48, 0.2);
      backdrop-filter: blur(10px);
      color: #ff3b30;
      padding: 16px 20px;
      border-radius: 12px;
      margin-bottom: 24px;
      border: 1px solid rgba(255, 59, 48, 0.3);
      font-weight: 500;
      font-size: 14px;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 24px;
      background: rgba(20, 20, 30, 0.85);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    thead {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.6) 0%, rgba(118, 75, 162, 0.6) 100%);
      backdrop-filter: blur(10px);
      border-radius: 16px 16px 0 0;
    }

    th {
      text-align: left;
      padding: 20px 24px;
      font-weight: 700;
      background: transparent;
      color: rgba(255, 255, 255, 0.98);
      font-size: 14px;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    th:first-child { border-top-left-radius: 16px; }
    th:last-child { border-top-right-radius: 16px; }

    td {
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 1);
      font-size: 15px;
      font-weight: 400;
    }

    tbody tr {
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: rgba(30, 30, 40, 0.6);
    }

    tbody tr:hover {
      background: rgba(50, 50, 65, 0.8);
      transform: scale(1.01);
    }

    tbody tr:last-child td:first-child { border-bottom-left-radius: 16px; }
    tbody tr:last-child td:last-child { border-bottom-right-radius: 16px; }
    tbody tr:last-child td { border-bottom: none; }

    .patient-code {
      font-weight: 700;
      background: linear-gradient(135deg, #a8b5ff 0%, #ffb3e6 50%, #8ec5fc 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 16px;
      letter-spacing: -0.3px;
    }

    .date {
      color: rgba(255, 255, 255, 0.9);
      font-size: 14px;
      font-weight: 500;
    }

    .count {
      text-align: center;
      color: rgba(255, 255, 255, 1);
      font-weight: 600;
      font-size: 15px;
    }

    .score {
      color: rgba(255, 255, 255, 1);
      font-size: 15px;
      font-weight: 600;
    }

    .score.good { color: #4ade80; }
    .score.warning { color: #fbbf24; }
    .score.bad { color: #f87171; }

    .score span.date-part {
      color: rgba(255, 255, 255, 0.6);
      font-weight: 400;
      font-size: 13px;
    }

    .doctor-cell {
      color: rgba(255, 255, 255, 0.92);
      font-size: 14px;
      font-weight: 500;
      white-space: nowrap;
    }

    .empty {
      text-align: center;
      padding: 60px 40px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 16px;
      font-weight: 500;
    }

    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    .back-btn {
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      color: rgba(30, 30, 50, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      margin-bottom: 24px;
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: translateY(-2px);
    }

    .chart-container {
      background: rgba(20, 20, 30, 0.85);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .chart-title {
      color: rgba(255, 255, 255, 1);
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      letter-spacing: -0.3px;
    }

    .chart-wrapper {
      position: relative;
      height: 300px;
    }

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 24px;
    }

    @media (max-width: 768px) {
      body {
        padding-top: 80px;
        padding-left: 12px;
        padding-right: 12px;
      }

      .container {
        padding: 32px 24px;
        border-radius: 20px;
        margin: 12px;
      }

      h1 {
        font-size: 32px;
      }

      th, td {
        padding: 16px 12px;
        font-size: 13px;
      }

      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Doctor profile modal */
    .doctor-profile-modal {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .doctor-profile-modal.is-visible {
      display: flex;
    }
    .doctor-profile-modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
    }
    .doctor-profile-modal-content {
      position: relative;
      background: #fff;
      border-radius: 20px;
      padding: 2rem;
      max-width: 440px;
      width: 100%;
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
    }
    .doctor-profile-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1e1e32;
      margin-bottom: 0.5rem;
    }
    .doctor-profile-subtitle {
      font-size: 0.95rem;
      color: #666;
      margin-bottom: 1.5rem;
    }
    .doctor-profile-form label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: #333;
      margin-bottom: 0.35rem;
    }
    .doctor-profile-form .required {
      color: #e53935;
    }
    .doctor-profile-form input,
    .doctor-profile-form select {
      width: 100%;
      padding: 0.65rem 1rem;
      font-size: 1rem;
      border: 1px solid #ddd;
      border-radius: 10px;
      margin-bottom: 1rem;
    }
    .doctor-profile-form input:focus,
    .doctor-profile-form select:focus {
      outline: none;
      border-color: #667eea;
    }
    .doctor-profile-error {
      color: #e53935;
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }
    .doctor-profile-save {
      width: 100%;
      padding: 0.75rem 1.25rem;
      font-size: 1rem;
      font-weight: 600;
      color: #fff;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }
    .doctor-profile-save:hover:not(:disabled) {
      opacity: 0.95;
    }
    .doctor-profile-save:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .doctor-profile-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 36px;
      height: 36px;
      font-size: 1.5rem;
      line-height: 1;
      color: #999;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
    }
    .doctor-profile-close:hover {
      color: #333;
    }
    body.modal-open {
      overflow: hidden;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    /* Hide all content until profile check is complete */
    body:not(.profile-checked) > *:not(.profile-check-loader) {
      display: none !important;
    }
    .profile-check-loader {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--gradient-soft, linear-gradient(180deg, #f8f9ff 0%, #fff5f5 50%, #f0f4ff 100%));
      z-index: 99999;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
  <script>
    // IMMEDIATE check - before page renders
    (function() {
      // Hide body content immediately
      document.documentElement.style.visibility = 'hidden';
      
      function showLoader() {
        var loader = document.createElement('div');
        loader.className = 'profile-check-loader';
        loader.innerHTML = '<div style="text-align: center; color: #666;"><div style="width: 40px; height: 40px; border: 3px solid rgba(102, 126, 234, 0.2); border-top-color: #667eea; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 1rem;"></div><div>Checking access...</div></div>';
        document.body.appendChild(loader);
        document.documentElement.style.visibility = 'visible';
      }
      
      function checkProfile() {
        // Wait for scripts to load
        if (typeof window.ILARS_AUTH_CHECK === 'undefined' || typeof window.ILARS_CONFIG === 'undefined' || typeof window.ILARS_AUTH === 'undefined') {
          setTimeout(checkProfile, 50);
          return;
        }
        
        showLoader();
        
        // Check authentication
        if (window.ILARS_AUTH_CHECK) {
          if (!window.ILARS_AUTH_CHECK.requireAuth()) {
            return; // Redirecting to login
          }
        }
        
        // Initialize Firebase Auth and wait for it to be ready
        function waitForAuth() {
          if (!window.ILARS_AUTH) {
            setTimeout(waitForAuth, 100);
            return;
          }
          
          // Initialize Firebase Auth if not already done
          if (!window.ILARS_AUTH.auth && window.ILARS_AUTH.init) {
            if (!window.ILARS_AUTH.init()) {
              console.error('Failed to initialize Firebase Auth');
              setTimeout(waitForAuth, 200);
              return;
            }
          }
          
          // Wait for auth state to settle
          setTimeout(function() {
            if (!window.ILARS_AUTH.auth || !window.ILARS_AUTH.auth.currentUser) {
              console.log('No Firebase user found, waiting...');
              setTimeout(waitForAuth, 500);
              return;
            }
            
            // Now we can safely get token
            performProfileCheck();
          }, 300);
        }
        
        function performProfileCheck() {
          // Check profile
          var profileCompleted = window.sessionStorage.getItem('ilars_doctor_profile_completed');
          
          if (!window.ILARS_AUTH || !window.ILARS_AUTH.getIdToken) {
            console.error('ILARS_AUTH.getIdToken not available');
            window.location.href = 'doctor-setup.html';
            return;
          }
          
          // Check if we just completed profile (from setup page)
          var justCompleted = window.sessionStorage.getItem('ilars_doctor_profile_completed') === '1';
          
          window.ILARS_AUTH.getIdToken(true).then(function(token) {
          var apiBase = (window.ILARS_CONFIG && window.ILARS_CONFIG.API_BASE_URL || '').replace(/\/$/, '');
          return fetch(apiBase + '/doctors/me', {
            headers: { 'Authorization': 'Bearer ' + token }
          }).then(function(r) {
            return r.json().then(function(data) {
              return { ok: r.ok, status: r.status, data: data };
            });
          });
        }).then(function(result) {
          if (result.data.status === 'ok' && result.data.needs_profile) {
            // If we just completed profile but it's not showing as complete yet, wait a bit
            if (justCompleted) {
              console.log('Profile just completed, waiting for database sync...');
              setTimeout(function() {
                // Retry once more
                window.ILARS_AUTH.getIdToken(true).then(function(token) {
                  var apiBase = (window.ILARS_CONFIG && window.ILARS_CONFIG.API_BASE_URL || '').replace(/\/$/, '');
                  return fetch(apiBase + '/doctors/me', {
                    headers: { 'Authorization': 'Bearer ' + token }
                  }).then(function(r) {
                    return r.json().then(function(data) {
                      if (data.status === 'ok' && !data.needs_profile) {
                        window.sessionStorage.setItem('ilars_doctor_profile_completed', '1');
                        var loader = document.querySelector('.profile-check-loader');
                        if (loader) loader.remove();
                        document.body.classList.add('profile-checked');
                        document.documentElement.style.visibility = 'visible';
                        document.documentElement.style.opacity = '1';
                        initializeDashboard();
                      } else {
                        window.location.href = 'doctor-setup.html';
                      }
                    });
                  });
                }).catch(function() {
                  window.location.href = 'doctor-setup.html';
                });
              }, 1500);
            } else {
              window.location.href = 'doctor-setup.html';
            }
          } else if (result.data.status === 'ok' && !result.data.needs_profile) {
            window.sessionStorage.setItem('ilars_doctor_profile_completed', '1');
            // Show dashboard
            var loader = document.querySelector('.profile-check-loader');
            if (loader) loader.remove();
            document.body.classList.add('profile-checked');
            document.documentElement.style.visibility = 'visible';
            document.documentElement.style.opacity = '1';
            initializeDashboard();
          } else {
            window.location.href = 'doctor-setup.html';
          }
          }).catch(function(err) {
            console.error('Profile check failed:', err);
            // If we just completed profile, give it a chance
            if (justCompleted) {
              console.log('Just completed profile, retrying after delay...');
              setTimeout(function() {
                performProfileCheck();
              }, 2000);
            } else {
              window.location.href = 'doctor-setup.html';
            }
          });
        }
        
        // Start auth initialization and wait
        waitForAuth();
      }
      
      function initializeDashboard() {
        if (window.ILARS_NAV && typeof window.ILARS_NAV.init === 'function') {
          window.ILARS_NAV.init();
        }
        if (window.ILARS_DOCTOR_PROFILE && window.ILARS_DOCTOR_PROFILE.init) {
          window.ILARS_DOCTOR_PROFILE.init();
        }
      }
      
      // Start check immediately
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkProfile);
      } else {
        checkProfile();
      }
    })();
  </script>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="navbar-inner">
      <a href="index.html" class="navbar-logo">
        <img src="images/icon.png" alt="iLARS" class="navbar-icon" />
        <span class="navbar-logo-text">iLARS</span>
      </a>
      <ul class="navbar-menu">
        <li><a href="index.html">Home</a></li>
        <li><a href="#" id="btn-logout" class="btn btn-login">Log out</a></li>
      </ul>
      <button class="navbar-toggle" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>

  <!-- Patient List View -->
  <div id="patient-list-view" class="view active">
    <div class="container">
      <div class="patient-list-header">
        <h1>Patient List</h1>
        <div class="patient-list-actions">
          <button id="btn-create-patient" type="button" class="create-patient-btn">
            Create patient
          </button>
        </div>
      </div>
      <div id="patient-list-error" class="error" style="display: none;"></div>
      <table id="patients-table" style="display: none;">
        <thead>
          <tr>
            <th>Patient Code</th>
            <th>Created</th>
            <th>Weekly</th>
            <th>Monthly</th>
            <th>Last LARS</th>
            <th>EQ-5D-5L</th>
            <th>Doctor</th>
          </tr>
        </thead>
        <tbody id="patients-tbody">
        </tbody>
      </table>
    </div>
  </div>

  <!-- Patient Detail View -->
  <div id="patient-detail-view" class="view">
    <div class="container">
      <button class="back-btn" onclick="window.app.navigate('list')">← Back to Patient List</button>
      <h1>Patient: <span id="patient-detail-code"></span></h1>
      <div id="patient-detail-loading" class="loading">Loading patient data...</div>
      <div id="patient-detail-error" class="error" style="display: none;"></div>
      <div id="patient-detail-content" style="display: none;">
        <div style="margin-bottom: 1.5rem; display: flex; gap: 12px; flex-wrap: wrap;">
          <button id="patient-archive-btn" type="button" class="create-patient-btn" style="background-image: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); box-shadow: 0 6px 18px rgba(129, 140, 248, 0.45);">
            Archive patient
          </button>
          <button id="patient-delete-btn" type="button" class="create-patient-btn" style="background-image: linear-gradient(135deg, #f97373 0%, #fb7185 100%); box-shadow: 0 6px 18px rgba(248, 113, 113, 0.45);">
            Remove from list
          </button>
        </div>
        <div class="charts-grid">
          <!-- LARS Score Chart -->
          <div class="chart-container">
            <div class="chart-title">LARS Score Over Time</div>
            <div class="chart-wrapper">
              <canvas id="lars-chart"></canvas>
            </div>
          </div>

          <!-- EQ-5D-5L Chart -->
          <div class="chart-container">
            <div class="chart-title">EQ-5D-5L Health VAS</div>
            <div class="chart-wrapper">
              <canvas id="eq5d5l-chart"></canvas>
            </div>
          </div>

          <!-- LARS vs Food Consumption -->
          <div class="chart-container">
            <div class="chart-title">LARS Score vs Food Consumption</div>
            <div class="chart-wrapper">
              <canvas id="lars-food-chart"></canvas>
            </div>
          </div>

          <!-- LARS vs Daily Metrics -->
          <div class="chart-container">
            <div class="chart-title">LARS Score vs Daily Symptoms</div>
            <div class="chart-wrapper">
              <canvas id="lars-symptoms-chart"></canvas>
            </div>
          </div>

          <!-- Food Consumption -->
          <div class="chart-container">
            <div class="chart-title">Food Consumption (Last 30 Days)</div>
            <div class="chart-wrapper">
              <canvas id="food-chart"></canvas>
            </div>
          </div>

          <!-- Drink Consumption -->
          <div class="chart-container">
            <div class="chart-title">Drink Consumption (Last 30 Days)</div>
            <div class="chart-wrapper">
              <canvas id="drink-chart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Doctor profile modal (overlay) -->
  <div id="doctor-profile-modal" class="doctor-profile-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="doctor-profile-title">
    <div class="doctor-profile-modal-backdrop"></div>
    <div class="doctor-profile-modal-content">
      <h2 id="doctor-profile-title" class="doctor-profile-title">Complete your profile</h2>
      <p class="doctor-profile-subtitle">Please fill in your details to use the doctor dashboard.</p>
      <form id="doctor-profile-form" class="doctor-profile-form">
        <label for="doctor-profile-first-name">First name</label>
        <input type="text" id="doctor-profile-first-name" name="first_name" placeholder="First name" autocomplete="given-name">
        <label for="doctor-profile-last-name">Last name</label>
        <input type="text" id="doctor-profile-last-name" name="last_name" placeholder="Last name" autocomplete="family-name">
        <label for="doctor-profile-hospital">Hospital <span class="required">*</span></label>
        <select id="doctor-profile-hospital" name="hospital_id" required>
          <option value="">Select hospital</option>
        </select>
        <label for="doctor-profile-dob">Date of birth</label>
        <input type="date" id="doctor-profile-dob" name="date_of_birth" placeholder="YYYY-MM-DD">
        <p id="doctor-profile-error" class="doctor-profile-error" role="alert" style="display: none;"></p>
        <button type="submit" id="doctor-profile-save" class="doctor-profile-save">Save</button>
      </form>
      <button type="button" id="doctor-profile-close" class="doctor-profile-close" aria-label="Close">×</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  
  <script src="js/config.js"></script>
  <script src="js/firebase/config.js"></script>
  <script src="js/firebase/auth.js"></script>
  <script src="js/auth-check.js"></script>
  <script src="js/components/nav.js"></script>
  <script src="js/doctors/api.js"></script>
  <script src="js/doctors/profile.js"></script>
  <script src="js/doctors/views/patient-list.js"></script>
  <script src="js/doctors/views/patient-detail.js"></script>
  <script src="js/doctors/app.js"></script>
  <script>
    // Logout button handler (only after dashboard is shown)
    (function() {
      document.addEventListener('DOMContentLoaded', function() {
        var logoutBtn = document.getElementById('btn-logout');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            if (window.ILARS_AUTH_CHECK && window.ILARS_AUTH_CHECK.signOut) {
              window.ILARS_AUTH_CHECK.signOut().then(function() {
                window.location.href = 'login.html';
              });
            } else {
              window.location.href = 'login.html';
            }
          });
        }
      });
    })();
  </script>
</body>
</html>
